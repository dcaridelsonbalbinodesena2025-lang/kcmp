<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.C.M CONTROL V19</title>
    <style>
        :root { --neon-blue: #1e90ff; --neon-green: #00ff88; --neon-red: #ff3355; --bg-dark: #05070a; }
        body { background: var(--bg-dark); color: white; font-family: sans-serif; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 600px; }
        .card { background: #111418; border: 1px solid #333; border-radius: 15px; padding: 10px; text-align: center; }
        .thermometer { width: 100%; height: 8px; background: #222; border-radius: 4px; margin: 5px 0; }
        .fill { height: 100%; background: var(--neon-green); transition: 0.5s; width: 50%; }
        .status { font-size: 10px; color: var(--neon-blue); height: 30px; }
        .price { font-family: monospace; color: #f0b90b; }
        select { width: 100%; background: #000; color: #fff; border: 1px solid #444; padding: 5px; margin-top: 5px; font-size: 10px; }
        .off-card { opacity: 0.5; }
    </style>
</head>
<body>

    <h3>K.C.M MULTI-CONTROL</h3>
    <div id="grid" class="grid-container"></div>

<script>
    const URL_SRV = "https://kcmp-riwu.onrender.com";
    const LISTA = `
        <option value="OFF" style="color:red">ðŸ”´ DESATIVAR CARD</option>
        <optgroup label="ðŸŒ FOREX">
            <option value="frxEURUSD">EUR/USD</option>
            <option value="frxGBPUSD">GBP/USD</option>
            <option value="frxUSDJPY">USD/JPY</option>
        </optgroup>
        <optgroup label="ðŸ”¥ SINTÃ‰TICOS">
            <option value="1HZ10V">Volatility 10 (1s)</option>
            <option value="1HZ100V">Volatility 100 (1s)</option>
            <option value="R_100">Volatility 100</option>
        </optgroup>
        <optgroup label="â‚¿ CRIPTO">
            <option value="cryBTCUSD">BITCOIN</option>
        </optgroup>`;

    // Criar 6 cards
    for(let i=1; i<=6; i++) {
        document.getElementById('grid').innerHTML += `
            <div class="card" id="card-div-card${i}">
                <div style="font-size:9px">MONITOR ${i}</div>
                <div class="thermometer"><div class="fill" id="fill-card${i}"></div></div>
                <div class="status" id="status-card${i}">OFFLINE</div>
                <div class="price" id="price-card${i}">0.0000</div>
                <select id="sel-card${i}" onchange="enviarComando('card${i}')">${LISTA}</select>
            </div>`;
    }

    async function enviarComando(cardId) {
        const sel = document.getElementById('sel-'+cardId);
        const ativoId = sel.value;
        const nomeAtivo = sel.options[sel.selectedIndex].text;
        
        await fetch(`${URL_SRV}/mudar`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cardId, ativoId, nomeAtivo })
        });
    }

    async function sync() {
        try {
            const res = await fetch(`${URL_SRV}/status`);
            const data = await res.json();
            data.ativos.forEach(a => {
                const card = document.getElementById('card-div-'+a.cardId);
                if (a.status === "DESATIVADO") {
                    card.classList.add('off-card');
                } else {
                    card.classList.remove('off-card');
                }
                document.getElementById('status-'+a.cardId).innerText = a.status;
                document.getElementById('price-'+a.cardId).innerText = a.preco;
                document.getElementById('fill-'+a.cardId).style.width = a.forca + "%";
            });
        } catch (e) {}
    }

    setInterval(sync, 1000);
</script>
</body>
</html>
